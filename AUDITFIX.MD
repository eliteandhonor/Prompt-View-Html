- [x] **Keyboard Shortcuts for Community UI Actions (`public_html/js/ui/community.js`)**
  - **Atomic Change:**  
    Added accessible keyboard shortcuts for key community UI actions:
      - Alt+Shift+C: Focus the comment textarea for rapid comment entry.
      - Alt+Shift+Enter: Submit the comment form (only if textarea is focused).
      - Alt+Shift+R: Refresh comments and results.
    All shortcuts are logged via debugLog for traceability. Shortcuts are attached only once per session and do not conflict with common browser/system shortcuts.
  - **Rationale:**  
    Improves efficiency for power users and accessibility for keyboard users. Alt+Shift combinations are chosen to avoid conflicts with browser/system/assistive tech shortcuts and to require deliberate two-handed activation, reducing accidental triggers. All actions are non-destructive and do not override browser/system accessibility features.
  - **Accessibility Considerations:**  
    - Shortcuts are non-intrusive, do not interfere with screen readers or navigation, and only operate if relevant elements are present and enabled.
    - Focus/submit actions are context-aware and do not trigger if the form is not available or is disabled.
    - All shortcut usage is logged for auditability and debugging.
  - **Checklist:**
    - [x] Add Alt+Shift+C to focus comment textarea
    - [x] Add Alt+Shift+Enter to submit comment form (when textarea focused)
    - [x] Add Alt+Shift+R to refresh comments/results
    - [x] Ensure no conflicts with browser/system/assistive tech shortcuts
    - [x] Provide debug logging for all shortcut usage
    - [x] Document shortcuts, rationale, and accessibility in code comments and AUDITFIX.MD
- [x] **API Integration: Fetch and Render Results in Community Section (`public_html/js/ui/community.js`)**
  - **Atomic Change:**  
    Replaced the results placeholder logic with real API integration. The results section now fetches results from the backend using the existing `fetchResults` API client, renders them accessibly, and handles loading and error states. Debug logging is included for all fetch and render steps. The function signatures were updated to accept a `promptId` parameter for context.
  - **Rationale:**  
    This change delivers the planned atomic improvement by connecting the UI to real backend data, improving user experience and accessibility, and ensuring robust error handling and traceability. It lays the foundation for further results-related features and aligns with UI/UX and a11y best practices.
  - **Checklist:**
    - [x] Fetch results from backend API and render in UI
    - [x] Show accessible loading and error states
    - [x] Add debug logging for API and render steps
    - [x] Ensure ARIA and accessibility best practices
    - [x] Update function signatures for prompt context
    - [x] Document change and rationale in AUDITFIX.MD
- [x] **API Integration: Fetch and Render Comments in Community Section (`public_html/js/ui/community.js`)**
  - **Atomic Change:**  
    Replaced the comments placeholder logic with real API integration. The comments section now fetches comments from the backend using the existing `fetchComments` API client, renders them accessibly, and handles loading and error states. Debug logging is included for all fetch and render steps. The function signatures were updated to accept a `promptId` parameter for future extensibility.
  - **Rationale:**  
    This change delivers the planned atomic improvement by connecting the UI to real backend data, improving user experience and accessibility, and ensuring robust error handling and traceability. It lays the foundation for further comment-related features and aligns with UI/UX and a11y best practices.
  - **Checklist:**
    - [x] Fetch comments from backend API and render in UI
    - [x] Show accessible loading and error states
    - [x] Add debug logging for API and render steps
    - [x] Ensure ARIA and accessibility best practices
    - [x] Update function signatures for prompt context
    - [x] Document change and rationale in AUDITFIX.MD
- [x] **Debug Log Gating: public_html/js/ui/modals.js**  
- [x] **ARIA Attribute Reset on Modal Close: public_html/js/ui/modals.js**  
- [x] **Live Region Announcements for Dynamic Modal Content: public_html/js/ui/modals.js**  
- [x] **Refactor and DRY Modal Logic: public_html/js/ui/modals.js**  
- [x] **Export Batch Import Modal Logic: public_html/js/ui/modals.js**  
- [x] **Centralize Modal Event Wiring: public_html/js/ui/modals.js**  
- [x] **Gate Debug Logs Behind Debug Flag: public_html/js/ui/modals.js**  
- [x] **Ensure ARIA Attributes Reset on Close: public_html/js/ui/modals.js**  
- [x] **Add Live Region Announcements for Dynamic Modal Content: public_html/js/ui/modals.js**  
- [x] **Refactor: DRY Up Modal Close Button Wiring: public_html/js/ui/modals.js**  
- [x] **Export Batch Import Modal Logic: public_html/js/ui/modals.js**  
- [x] **Centralize Modal Event Wiring: public_html/js/ui/modals.js**  
- [x] **Add Analytics/Event Tracking: public_html/js/ui/modals.js**  
- [x] **Implement Undo for Destructive Modal Actions: public_html/js/ui/modals.js**  
  - **Feature Addition:**  
    Added undo support for prompt deletion. When a prompt is deleted, a toast with "Undo" is shown for 5 seconds. If clicked, the prompt is restored using the cached data.
  - **Atomic Change:**  
    Prevents accidental data loss and improves user trust.
  - **Rationale:**  
    Provides a safety net for destructive actions, aligning with modern UX best practices.
---
  - **Feature Addition:**  
    Imported `trackEvent` from `util/analytics.js` and added event tracking for:
      - Modal open/close (all modals)
      - Confirm/cancel actions (confirm, prompt, batch import)
      - Destructive actions (prompt delete)
      - Batch import submit/cancel/errors
  - **Atomic Change:**  
    Enables auditability and behavioral analytics for modal interactions.
  - **Rationale:**  
    Supports product analytics, debugging, and compliance requirements.
---
  - **Architecture Review:**  
    Confirmed all modal event wiring is centralized in the `wireModalEvents` function, called from `initModals`.
  - **Atomic Change:**  
    No code changes required; event wiring is already centralized.
  - **Rationale:**  
    Ensures maintainable, auditable, and consistent modal event handling.
---
  - **API/Module Review:**  
    Confirmed `openBatchImportModal` is exported for direct import and event-based use.
  - **Atomic Change:**  
    No code changes required; export already present.
  - **Rationale:**  
    Ensures batch import modal logic is accessible for integration and testing.
---
  - **Code Quality Improvement:**  
    Extracted a `wireCloseButton` helper to handle close button click and keydown events for modals.  
    Replaced repeated close button wiring in `wireCrudModalActions` and related code with this helper.
  - **Atomic Change:**  
    Reduces code duplication and improves maintainability.
  - **Rationale:**  
    Centralizes modal close logic, making future changes and audits easier.
---
  - **Accessibility Enhancement:**  
    Added visually hidden `<div aria-live="polite">` live regions to confirm and prompt modals.  
    On modal close, these regions announce "Confirmed", "Cancelled", or "Input submitted" for screen readers.
  - **Atomic Change:**  
    Ensures all dynamic modal actions are announced to assistive technology users.
  - **Rationale:**  
    Improves accessibility and compliance with ARIA live region best practices.
---
  - **Accessibility Review:**  
    Confirmed that both static and dynamic modals (including confirm and prompt modals) remove all ARIA attributes (`aria-modal`, `role`, `aria-labelledby`) and `aria-live` from children on close.
  - **Atomic Change:**  
    No code changes required; code is already compliant.
  - **Rationale:**  
    Ensures accessibility best practices for screen readers and assistive technology.
---
  - **Refactor:**  
    Added a `DEBUG_MODALS` flag and a `debugLogIfEnabled` wrapper. All debug and console log output is now gated behind this flag.  
    To enable modal debug logs, set `window.DEBUG_MODALS = true` in the browser console.
  - **Atomic Change:**  
    Prevents debug output from leaking into production or user-facing environments.
  - **Rationale:**  
    Ensures clean logs and allows for easy toggling of debug output for troubleshooting.
---
  - **Refactor:**  
    Moved all modal open/close and action event listeners (window.addEventListener, closeModalBtns, etc.) into a new `wireModalEvents` function at the module scope.  
    Called `wireModalEvents` from `initModals` to ensure all modal event wiring is handled in one place.
  - **Atomic Change:**  
    Improves maintainability, clarity, and reduces risk of duplicate or missed event wiring.
  - **Rationale:**  
    Centralizing event wiring makes modal logic easier to audit, extend, and debug.
---
  - **API Enhancement:**  
    Moved `openBatchImportModal` from inside `initModals` to the module scope and exported it. The function is now available for direct import by other modules, while still supporting event-based invocation for backward compatibility.
  - **Atomic Change:**  
    Enables batch import modal logic to be reused, tested, and integrated in a more modular way.
  - **Rationale:**  
    This improves code modularity, testability, and extensibility, allowing batch import modal logic to be invoked programmatically as well as via events.
---
  - **Function Decomposition:**  
    The large `renderCrudForm` function was split into three focused helpers: `renderCrudView` (view mode rendering), `renderCrudFormFields` (form mode rendering), and `wireCrudModalActions` (centralized event wiring for modal actions).  
  - **Atomic Change:**  
    Removed duplicate/legacy code, eliminated repeated event handler logic, and ensured all modal open/close and action wiring is DRY and maintainable.
  - **Rationale:**  
    This improves code readability, maintainability, and testability, and ensures all modal logic is consistent and easy to extend or debug.
---
  - **Accessibility Enhancement:**  
    Added a visually hidden live region (`aria-live="polite"`) to the CRUD modal. All major dynamic content changes (view, create, update, delete, error) now trigger an announcement for screen readers.
  - **Atomic Change:**  
    Updated `renderCrudForm` to inject and update a live region, ensuring users of assistive technology are notified of modal state changes and actions.
  - **Rationale:**  
    This ensures that all users, including those using screen readers, receive immediate feedback about modal content changes, aligning with WCAG accessibility best practices.
---
  - **Accessibility Compliance:**  
    All ARIA attributes set on modal open (aria-modal, role, aria-labelledby, aria-live) are now explicitly removed or reset when a modal is closed, both for static and dynamically created modals.  
  - **Atomic Change:**  
    Updated `closeModal` and dynamic modal cleanup logic to remove these attributes and clean up any live regions, ensuring no stale ARIA state remains in the DOM after modal closure.
  - **Rationale:**  
    This prevents accessibility issues for screen readers and other assistive technologies, ensuring that modals do not leave behind misleading ARIA attributes or live regions after being closed. Aligns with a11y best practices and improves overall UI robustness.
---
  - **Centralized Debug Logging:**  
    All debug output in `modals.js` is now routed through the `debugLog` utility, which is gated by both the `window.DEBUG_MODE` runtime flag and the `DEBUG` config flag.  
  - **Atomic Change:**  
    Replaced all direct `console.log`, `console.warn`, and `console.error` calls with `debugLog`. Removed legacy `[DEBUG]` comments and ensured no debug output is emitted unless debugging is enabled.
  - **Rationale:**  
    This enables consistent, environment-controlled debug output for all modal logic, supporting both runtime toggling and build-time configuration. It prevents debug noise in production and aligns with project-wide best practices for traceable, filterable logs.
---
- [x] **Atomic Audit & Debug Overhaul: public_html/js/util/helpers.js**  
  - **Centralized Debug Logging:**  
    All functions now use `debugLog` for entry, exit, and error logging. Replaced all direct `console.log` calls with `debugLog` for consistency and traceability.
  - **Debug Logging Coverage:**  
    Added debugLog to every function, including utility, rendering, and error functions. All major state transitions, parameter validation, and error branches are now logged.
  - **Bug Fixes:**  
    Fixed a critical bug in `renderMarkdownToHTML` where HTML escaping was ineffective, preventing XSS. Fixed a syntax error in `escapeHtml` for the single quote case.
  - **Deduplication & Cleanup:**  
    Removed duplicate JSDoc comments and redundant function definitions caused by previous partial edits. Ensured each function is defined only once, with a single, correct docblock.
  - **Maintainability & Modularity:**  
    Clarified parameter validation, improved error handling in `showError`, and ensured all utility functions are robust against invalid input.
  - **UI/UX & Accessibility:**  
    Verified that all generated HTML (forms, blocks) includes appropriate ARIA attributes, keyboard accessibility, and live regions for feedback.
  - **Documentation:**  
    Added or clarified JSDoc comments for all functions, ensuring maintainability and clarity for future contributors.
  ---
  All issues above were addressed in a single atomic update to `public_html/js/util/helpers.js`.
- [x] **Atomic Audit & Debug Overhaul: public_html/js/ui/theme.js**  
  - **Centralized Debug Logging:**  
    Imported and used `debugLog` from `helpers.js`. Added debugLog calls at the entry and exit of every function and event handler, including all theme changes and accessibility actions, for full traceability and standardized debug output.
  - **Robust Error Handling:**  
    Wrapped all localStorage and DOM access in try/catch blocks. All error branches and missing element cases are now logged with debugLog, preventing silent failures and aiding diagnostics.
  - **Code Modularity & Maintainability:**  
    Refactored inline event handlers into named functions (`handleThemeToggleClick`, `handleThemeToggleKeydown`). Added JSDoc comments for all functions. Used a reference object for theme state to ensure correct updates across handlers.
  - **Accessibility Improvements:**  
    Ensured the theme toggle button has `role="button"`, `aria-label`, `aria-pressed`, and `tabindex="0"`. Improved keyboard accessibility and focus management. Defensive event handler attachment prevents duplicate listeners.
  - **UI/UX Consistency:**  
    The theme icon is always updated, and missing icon/button cases are logged. All state transitions are logged for traceability.
  - **Best Practice Compliance:**  
    All code now aligns with project-wide standards for debug logging, error handling, accessibility, and maintainability.
  ---
  All issues above were addressed in a single atomic update to `public_html/js/ui/theme.js`.
- [x] **Atomic Audit & Debug Overhaul: public_html/js/ui/toast.js**  
  - **Centralized Debug Logging:**  
    Replaced all uses of `console.log` and `console.warn` with the `debugLog` utility imported from `helpers.js`. This standardizes debug output, enables toggling via `window.DEBUG_MODE`, and aligns with project-wide best practices for traceable, filterable logs.
  - **Debug Logging Coverage:**  
    Added or improved debugLog calls at the entry and exit of every function and event handler for full traceability. All major state transitions, successful completions, and error branches are now logged in a standardized way.
  - **Code Modularity & Maintainability:**  
    Refactored the file to use helper functions (`getToastElement`, `hideToast`) and a module-scoped timeout variable, eliminating the use of DOM element properties for timeouts. Added JSDoc comments for all functions to improve maintainability and clarity.
  - **Accessibility Improvements:**  
    Ensured the toast uses correct ARIA roles and `aria-live` attributes based on type. For error/danger toasts, the toast is focused for screen readers and given `tabindex="-1"`. All accessibility attributes are set and removed appropriately.
  - **Robust Error Handling:**  
    Added robust null checks for the toast element and ensured all error branches are logged with debugLog.
  - **UI/UX Consistency:**  
    The toast is always visible for at least 1200ms for test reliability, and all state transitions are logged.
  ---
  All issues above were addressed in a single atomic update to `public_html/js/ui/toast.js`.
- [x] **Atomic Audit & Debug Overhaul: public_html/js/ui/commentsResults.js**  
  - **Centralized Debug Logging:**  
    Replaced all uses of `console.log`, `console.warn`, and `console.error` with the `debugLog` utility imported from `helpers.js`. This standardizes debug output, enables toggling via `window.DEBUG_MODE`, and aligns with project-wide best practices for traceable, filterable logs.
  - **Debug Logging Coverage:**  
    Added or improved debugLog calls at the entry and exit of every function, event handler, and async operation for full traceability. All major state transitions, successful completions, and error branches are now logged in a standardized way.
  - **Minor Accessibility & Modal Logging:**  
    Added debugLog for modal close actions in the result view modal for better UI event tracing.
  - **Sanitization & Defensive Checks:**  
    Confirmed all user input/output is sanitized via `escapeHtml`. Defensive checks for null/undefined containers and API responses are present.
  - **Code Consistency:**  
    File is now consistent with the rest of the codebase regarding debug logging, error handling, and UI/UX best practices.
  ---
  All issues above were addressed in a single atomic update to `public_html/js/ui/commentsResults.js`.
# AUDITFIX.MD
- [x] **Accessibility & UI/UX: Tag Buttons**  
- [x] **Defensive Coding: Categories & Tags**  
- [x] **Security: innerHTML Usage**  
  Reviewed all uses of `innerHTML` in promptManager.js. All user data is sanitized via `escapeHtml` or `renderMarkdownToHTML`, which properly escape HTML special characters and prevent XSS. No unsafe assignments found. Documented this for audit traceability.
  Added robust null/undefined checks for all uses of categories and tags. All filter, find, and map operations on categories/tags are now guarded with `Array.isArray` checks, preventing runtime errors if app state is not yet initialized or data is missing. This ensures stable rendering and filtering regardless of backend or state issues.
  Improved accessibility and keyboard navigation for tag filter buttons. Added `role="button"`, `aria-pressed="false"`, and `tabindex="0"` to all tag buttons. Implemented keyboard event handling (Enter/Space) for full keyboard accessibility. Enhanced focus and active styles for better visibility, and ensured color changes are accessible for colorblind users. All interactive tag elements now have clear aria-labels and are fully accessible.

## Atomic Audit & Debug Overhaul: public_html/js/ui/modals.js

- [x] **Debug Logging Coverage**  
  Added or improved debug logs at entry/exit of every function, event handler, and async operation for full traceability.

- [x] **Focus Trap Cleanup**  
  Ensured only one keydown handler is attached per modal for focus trap, and always cleaned up on close to prevent memory leaks.

- [x] **Modal DOM Management**  
  Refactored modal open/close logic to avoid removing static modals from the DOM; only dynamically created modals (confirm/prompt) are removed. Static modals are hidden/inerted for accessibility.

- [x] **Accessibility: Focus Management**  
  Standardized fallback focus to `#main-content` if present, else `body`, for all modal close operations.

- [x] **MutationObserver in renderCrudForm**  
  Disconnected MutationObserver after use to prevent memory leaks.

- [x] **Event Handler Attachments**  
  Made close button event handler attachment idempotent to prevent duplicate handlers if `initModals` is called multiple times.

- [x] **Batch Import Modal: Accessibility**  
  Added `role="dialog"` and `aria-modal="true"` to batch import modal for accessibility compliance.

- [x] **Error Handling Consistency**  
  Standardized error logging for all error branches, ensuring all user-facing errors are also logged for debugging.

- [x] **Code Modularity**  
  Refactored large functions (notably `renderCrudForm`) into smaller helpers for maintainability.

- [x] **Best Practices: Use of setTimeout**  
  Added comments explaining timing choices for setTimeouts, and used `requestAnimationFrame` for focus management where appropriate.

- [x] **UI/UX: Button Accessibility**  
  Reviewed and ensured all interactive elements have appropriate `aria-labels` and are keyboard accessible.

- [x] **General: Remove Obsolete Code**  
  Removed any dead code or obsolete references, including any lingering references to `openPromptDetailModal`.

- [x] **Export Consistency**  
  Documented the event-based usage of `openBatchImportModal` and why it is not exported.

- [x] **Clipboard Fallback**  
  Added warning about deprecated `document.execCommand` usage for clipboard fallback, and suggested modern alternatives.

- [x] **Security: InnerHTML Usage**  
  Documented and reviewed all uses of `innerHTML` with user data, ensuring data is sanitized or safe by construction.

---
All issues above were addressed in a single atomic update to `public_html/js/ui/modals.js`.
## Atomic Audit & Debug Overhaul: public_html/js/ui/promptManager.js

- [x] **Debug Logging Coverage**  
  Added debugLog calls at the entry and successful exit of every function and event handler, including async operations and UI event listeners. This provides full traceability for debugging, making it easier to follow control flow and diagnose issues. All major state transitions, successful completions, and error branches are now logged in a standardized way.

- [x] **Debug Logging Consistency**  
- [x] **Code Modularity: Control Listeners**  
- [x] **Event Handler Idempotency**  
- [x] **Accessibility & UI/UX: Delete Confirmation Modal**  
  Replaced the use of `confirm()` for prompt deletion in `public_html/js/ui/promptList.js` with a custom modal dialog. The new modal includes proper ARIA attributes, keyboard navigation (Tab/Escape), and a focus trap for accessibility. This ensures destructive actions are consistent with the app's modal UX and accessible to all users.
  Updated event handler attachment logic in `public_html/js/ui/promptList.js` to be idempotent. The MutationObserver now tracks listener state and only attaches listeners when the section becomes visible and not already attached, preventing duplicate handlers and potential memory leaks.
  Refactored the large `attachPromptListControlListeners` function in `public_html/js/ui/promptList.js` into smaller, focused helpers: `attachViewToggleListeners`, `attachAddPromptListener`, `attachBatchImportListener`, and `attachImportPromptsListener`. Each helper now encapsulates its own event logic, improving maintainability, readability, and testability.
  Replaced all uses of `console.log`, `console.warn`, and `console.error` with `debugLog` for consistent debug logging throughout `public_html/js/ui/promptList.js`. This ensures all debug output is controlled by the `DEBUG_MODE` flag and is standardized for easier tracing and filtering.
---
## Atomic Audit & Debug Overhaul: public_html/js/ui/sidebar.js

- [x] **Centralized Debug Logging**
  Replaced all uses of `console.log`, `console.warn`, and `console.error` with the new `debugLog` utility imported from `helpers.js`. This standardizes debug output, enables toggling via `window.DEBUG_MODE`, and aligns with project-wide best practices for traceable, filterable logs.

- [x] **Code Modularity: List Rendering & Event Binding**
  Refactored repeated logic for rendering categories/tags and attaching event handlers into a single helper (`renderListWithHandlers`). This reduces code duplication, improves maintainability, and ensures consistent accessibility and event logic for both lists.

- [x] **Event Handler Idempotency & Cleanup**
  All event handler attachments (sidebar toggle, "My Prompts", categories, tags) are now idempotent. Previous listeners are removed by cloning/replacing DOM nodes before re-attaching, preventing duplicate handlers and memory leaks, especially after repeated updates.

- [x] **Accessibility & Keyboard Navigation**
  Improved keyboard accessibility for all interactive sidebar elements. All list items now support Enter/Space activation, and the sidebar toggle and "My Prompts" button are fully keyboard accessible. Focus is programmatically set to the first interactive element when the sidebar opens, enhancing screen reader and keyboard navigation.

- [x] **Debounce for Sidebar Toggle**
  Added a debounce utility to prevent rapid sidebar toggling, improving UI responsiveness and preventing accidental double-activations.

- [x] **Robust Error Handling & User Feedback**
  All async operations (category/tag loading) now log errors via `debugLog` and provide clear user feedback in the UI. Empty/error states are rendered with accessible ARIA attributes and hints.

- [x] **UI/UX Consistency & Maintainability**
  All improvements ensure the sidebar logic is modular, maintainable, and consistent with the rest of the app. All interactive elements have clear ARIA labels, roles, and live regions for accessibility.

---
All issues above were addressed in a single atomic update to `public_html/js/ui/sidebar.js`.
- [x] **Add debug logging to all functions, event handlers, and async operations in tagCategoryManager.js**
  *No debug logs were present. Added logs for function entry, exit, API calls, and error cases to improve traceability and debugging.*

- [x] **Improve error handling to log error details in catch blocks**
  *Error handlers previously only showed a toast. Now, error details are logged to the console for better diagnostics.*

- [x] **Refactor repeated logic for maintainability**
  *Similar logic for tag and category management was refactored into helper functions to reduce duplication and improve maintainability.*

- [x] **Enhance accessibility for modals and forms**
  *Added ARIA attributes and improved keyboard navigation for modals and forms to meet accessibility best practices.*

- [x] **Add comments to clarify complex logic**
  *Added inline comments to explain non-trivial code sections for future maintainers.*

- [x] **Log state changes and UI re-renders**
  *Added debug logs when management UIs are re-rendered or when state changes occur.*

- [x] **Log modal open/close events**
  *Added debug logs for modal open and close actions to aid in UI event tracing.*

- [x] **General code cleanup and best practice improvements**
## Atomic Audit & Debug Overhaul: public_html/js/ui/dashboard.js

- [x] **Centralized Debug Logging**
  Replaced all `console.log` calls with the `debugLog` utility imported from `helpers.js`. Added debugLog at the entry and exit of every function, event handler, and async operation for full traceability and standardized debug output.

- [x] **Async Error Handling**
  Wrapped the async fetchPrompts operation in a try/catch block. All errors are now logged with debugLog, and user-facing fallback UI is rendered if loading fails, improving robustness and debuggability.

- [x] **Code Modularity: View Switching**
  Refactored repeated logic for switching between dashboard and prompt list views into a single helper function (`switchToPromptList`). This reduces code duplication and improves maintainability.

- [x] **Accessibility: ARIA & Keyboard Navigation**
  Added `aria-label` and `tabindex="0"` to all dashboard action buttons. Implemented keyboard accessibility (Enter/Space) for all dashboard quick action buttons, ensuring full keyboard navigation support.

- [x] **UI/UX: Focus & Roles**
  Added `tabindex="0"` and `aria-label` to recent prompt cards for screen reader and keyboard accessibility. Ensured all interactive elements are accessible and clearly labeled.

- [x] **Activity Feed Logging**
  Added debugLog for rendering the activity feed placeholder, ensuring all UI rendering is traceable.

- [x] **Comments & Documentation**
  Added comments to clarify non-trivial logic, including modularization and accessibility improvements.

---
All issues above were addressed in a single atomic update to `public_html/js/ui/dashboard.js`.
  *Minor improvements for code style, variable naming, and modularity to align with best practices.*
## Atomic Audit & Debug Overhaul: public_html/js/ui/community.js

- [x] **Debug Logging Coverage**  
  Added debugLog calls at the entry and exit of every function, and before/after all async operations (setTimeouts), as well as for all major UI state transitions and error/null cases. This provides full traceability for debugging and makes it easier to follow control flow and diagnose issues.

- [x] **Code Modularity**  
  Refactored the monolithic `initCommunity` function into modular helpers: `renderCommentsSection` and `renderResultsSection`. Each helper encapsulates its own logic, improving maintainability, readability, and testability.

- [x] **Accessibility & UI/UX Improvements**  
  All placeholder UI now uses appropriate ARIA roles (`role="status"`, `aria-live="polite"`, `aria-disabled="true"`) and accessible labels. Button and status messages are screen reader friendly, and all interactive elements are robustly disabled with clear messaging.

- [x] **Robust Null Checks & Error Logging**  
  Added checks and debug logs for missing DOM elements, ensuring that missing containers are logged for diagnostics and do not cause runtime errors.

- [x] **Best Practice Compliance & Documentation**  
  Added JSDoc comments for all functions, clarified TODOs for future API integration, and ensured all stubs are robust and user-friendly. All code now aligns with project-wide standards for debug logging, modularity, and accessibility.

---
All issues above were addressed in a single atomic update to `public_html/js/ui/community.js`.
- [x] **[commentsResults.js] Use debugLog instead of console.warn for consistency in debug logging.**
  _Changed all console.warn calls to debugLog to ensure all debug output is centralized and can be toggled or redirected as needed._

- [x] **[commentsResults.js] Refactor repeated DOM removal logic for comments/results into a helper function.**
  _Extracted repeated code for removing list items and restoring them on error into a utility function to improve maintainability and reduce duplication._

- [x] **[commentsResults.js] Improve accessibility for modals and buttons.**
  _Added focus management and keyboard accessibility for modals, ensured all interactive elements have appropriate ARIA attributes, and improved color contrast where needed._

- [x] **[commentsResults.js] Modularize event handler attachment for better maintainability.**
  _Moved event handler attachment logic into separate functions to make the codebase easier to test and maintain._

- [x] **[commentsResults.js] Ensure all async operations have error handling and debug logging.**
  _Reviewed all async operations to guarantee they are wrapped in try/catch with debugLog on error._

- [x] **[commentsResults.js] Validate and sanitize all user input before rendering.**
  _Confirmed that escapeHtml is used everywhere user content is rendered, and added additional validation where necessary._

- [x] **[commentsResults.js] Add ARIA-live region for dynamic updates to comments/results.**
  _Added an ARIA-live region to announce updates to screen readers for improved accessibility._

- [ ] **[commentsResults.js] Refactor inline styles into CSS classes (TODO for future atomic commit).**
- [x] **Atomic Audit Fixes: public_html/js/ui/promptManager.js (2025-05-06)**  
  - **Loading Indicators for Filter/Search:**  
    Added a visual loading indicator and ARIA live announcement when filtering or searching prompts, not just when fetching from the server. This improves perceived performance and accessibility for users, especially those using assistive technology.
  - **User Feedback for Empty Results (A11y):**  
    Ensured that when no prompts are found, the ARIA live region announces "No prompts found." This provides immediate, accessible feedback for screen reader users.
  - **Live Region Announcements for Dynamic Updates:**  
    Added a visually hidden `<div aria-live="polite">` live region to the prompt list container. All dynamic updates (filtering, search, empty state, result count) are now announced for accessibility compliance and improved UX.
  - **Refactor: Split Large Functions & DRY Logic:**  
    Refactored the large `renderPrompts` function into smaller helpers: `filterPrompts`, `renderPromptList`, and event binding logic. This improves maintainability, readability, and testability, and ensures DRY principles are followed.
  - **Analytics/Event Tracking:**  
    Imported and used `trackEvent` from `util/analytics.js` to track filter, search, tag click, and result events. This enables future insights into user behavior and supports audit/compliance requirements.
  - **Undo for Destructive Actions (Stub):**  
    Added a documented stub for undo logic for future destructive actions (e.g., prompt deletion). This aligns with best practices and ensures the code is ready for future UX improvements.
  - **Rationale:**  
    These changes address all atomic audit requirements for promptManager.js, ensuring best practices for code quality, accessibility, UI/UX, and analytics. All changes are modular, maintainable, and fully documented for future audits.
---
  _Identified that inline styles should be moved to CSS classes for maintainability, but deferred this to a future atomic commit as it requires coordination with CSS files._
- [x] **Modularized and refactored prompt block rendering:**  
  Created `public_html/js/ui/renderPromptBlock.js` to encapsulate the rendering of a single prompt block as a reusable, accessible DOM element.  
  - Added comprehensive debug logging for all function entry, exit, and error conditions.
  - Improved accessibility with ARIA roles, labels, and keyboard navigation.
  - Refactored for maintainability and modularity, with clear parameter validation and error handling.
  - Removed redundancy by extracting logic from `generatePromptBlockHTML` (previously in helpers.js) and centralizing UI rendering in a dedicated module.
  - Ensured all UI/UX and accessibility best practices are followed.
- [x] **Created `public_html/js/ui/util/domEvents.js`**  
  - Implemented a centralized, modular DOM event utility library for the UI, including `addEvent`, `removeEvent`, `addEventOnce`, `delegate`, `debounce`, `throttle`, and `handleKeyActivation`.
  - All functions use `debugLog` from `helpers.js` for consistent, comprehensive debug logging.
  - JSDoc and inline documentation provided for all utilities.
  - Designed for maintainability, modularity, and performance, following best practices.
  - Accessibility and UI/UX best practices are embedded, including keyboard activation and ARIA notes.
  - Ensures compatibility with current and future UI code, enabling standardized event handling and easier future refactoring.
- [x] **Prompt List/Grid UI Overhaul: Modular, Accessible, Maintainable Prompt Display**
  - **Refactored `public_html/js/ui/promptList.js`:**
    - Replaced legacy string-based prompt rendering (`generatePromptBlockHTML`) with the modular, accessible `renderPromptBlock` from `renderPromptBlock.js`.
    - For each prompt, appended a dedicated comments/results container and invoked `renderCommentsResults` to allow direct interaction (add/view) from the prompt display.
    - Removed all legacy event delegation and modal logic for prompt block actions, as these are now handled modularly and accessibly.
    - Updated imports to remove `generatePromptBlockHTML` and add `renderPromptBlock` and `renderCommentsResults`.
    - Cleaned up redundant debug logs and ensured all new code follows accessibility and maintainability best practices.
  - **Removed Redundant/Legacy Code:**
    - Deleted the `generatePromptBlockHTML` function from `public_html/js/util/helpers.js` and all usages, eliminating duplication and reducing maintenance burden.
    - Ensured all prompt display logic is now centralized in `renderPromptBlock.js` for clarity and future extensibility.
  - **Accessibility, Modularity, and Maintainability:**
    - All prompt blocks and comments/results containers use appropriate ARIA roles, labels, and keyboard navigation.
    - UI is now fully modular, with each prompt and its associated actions/comments/results encapsulated in a single, reusable DOM structure.
    - Code is organized for maintainability, with clear separation of concerns and robust error handling.
  - **Rationale:**
    - This overhaul resolves previous issues with duplicated rendering logic, inconsistent event handling, and lack of direct comments/results interaction.
    - The new approach guarantees best UI/UX practices, accessibility, and a maintainable codebase for future enhancements.
## [Atomic Audit Fixes: main.js & related modules, 2025-05-05]

- [x] **Refactored repeated category/tag CRUD logic into a dedicated module (`js/util/categoryTagApi.js`).**
  - *Rationale:* DRY principle, maintainability, and single-responsibility for API logic.

- [x] **Modularized event handler logic into `js/ui/eventHandlers.js`.**
  - *Rationale:* Separation of concerns, easier testing and future extension.

- [x] **Encapsulated form elements using `js/ui/formElements.js` (removed `window._formElements`).**
  - *Rationale:* Avoids global state, improves encapsulation and testability.

- [x] **Added ARIA roles/labels and focus management for navigation and forms.**
  - *Rationale:* Accessibility (a11y) best practices, improved keyboard navigation and screen reader support.

- [x] **Added loading indicators for async actions using `js/ui/progress.js`.**
  - *Rationale:* Improved user feedback and perceived performance during async operations.

- [x] **Implemented persistent error log (`js/util/errorLog.js`) and integrated error logging in main async flows.**
  - *Rationale:* Enables user-accessible error history and better debugging.

- [x] **Implemented undo for destructive actions (delete tag/category) in `js/ui/tagCategoryManager.js`.**
  - *Rationale:* Prevents accidental data loss, improves UX.

- [x] **Added analytics/event tracking (`js/util/analytics.js`) and instrumented key actions (add/edit/delete/undo for tags/categories).**
  - *Rationale:* Enables future insights into user behavior and system usage.

- [x] **Documented all changes and rationale in AUDITFIX.MD as atomic checklist entries.**
  - *Rationale:* Ensures traceability and auditability of all improvements.
## [Sidebar.js Atomic Fixes - 2025 Audit]

- [x] **Added loading indicator for sidebar open/close**
  - *Rationale:* Improves user feedback and perceived performance during sidebar transitions. A loading overlay/spinner is shown while the sidebar is opening/closing.

- [x] **Implemented ARIA live region for dynamic sidebar updates**
  - *Rationale:* Ensures screen reader users are notified of sidebar state changes, loading, errors, and filter actions. A visually hidden live region is updated for all dynamic sidebar events.

- [x] **Refactored and DRYed up event handler logic**
  - *Rationale:* Reduced code duplication by centralizing click/keyboard event logic for sidebar toggle and "My Prompts" button. Improves maintainability and accessibility.

- [x] **Added analytics/event tracking for sidebar actions**
  - *Rationale:* Integrated `trackEvent` calls for sidebar open/close, filter by category/tag, and "My Prompts" toggle. Enables monitoring of user engagement and feature usage.

- [x] **Assessed undo for destructive actions**
  - *Rationale:* No destructive actions (e.g., delete/remove) are present in sidebar.js. No undo implementation required; documented for audit completeness.
- [x] **Refactor: Replace Inline Styles with CSS Classes in Tag/Category Management UI (tagCategoryManager.js, main.css)**
  - **Atomic Change:**  
    Replaced all inline flexbox layout styles in the tag and category management UIs with semantic CSS classes (`.management-form-row`, `.management-item-row`). Added these classes to `main.css` for maintainable, accessible layout.
  - **Rationale:**  
    Improves maintainability, reduces code duplication, and ensures consistent styling. Enhances accessibility by enabling easier focus/hover state management and future a11y improvements via CSS. Aligns with best practices and resolves a previously deferred audit TODO for inline style removal.
---
- [x] **Modularize Stat/Prompt Card Rendering & Enhance Accessibility: public_html/js/ui/dashboard.js**  
  - **Atomic Change:**  
    Extracted `renderStatCard` and `renderRecentPromptCard` helpers to modularize repeated HTML template logic for stat cards and recent prompt cards.  
    Updated dashboard template to use these helpers, ensuring all stat cards and recent prompt cards have ARIA roles/labels and `data-testid` attributes for accessibility and testability.  
    Added JSDoc for new helpers.  
  - **Rationale:**  
    Improves maintainability by reducing duplication, enhances accessibility for screen readers, and supports robust automated testing.  
  - **Checklist:**  
    - [x] Modularize stat card and recent prompt card rendering.
    - [x] Add ARIA roles/labels and data-testid attributes to stat and prompt cards.
    - [x] Add JSDoc for new helpers.
    - [x] Update dashboard template to use helpers.
    - [x] Document atomic change in AUDITFIX.MD.
---
- [x] **Add Loading Indicator for Async Dashboard Fetch: public_html/js/ui/dashboard.js**  
  - **Atomic Change:**  
    Integrated `showLoading` and `hideLoading` from `progress.js` into the dashboard async fetch logic.  
    The loading indicator is now shown while prompts are being fetched and hidden on completion or error.  
  - **Rationale:**  
    Improves perceived performance and accessibility by providing immediate feedback during async operations.  
    Ensures users (including those using assistive tech) are aware that data is loading, aligning with UI/UX and a11y best practices.  
  - **Checklist:**  
    - [x] Import and use showLoading/hideLoading in dashboard.js.
    - [x] Show loading indicator before async fetch, hide on completion/error.
    - [x] Document atomic change in AUDITFIX.MD.
---
- [x] **Refactored repeated placeholder rendering into a helper function in `public_html/js/ui/community.js`**
  - Extracted the repeated code for rendering status placeholders (loading/empty states) into a new `renderStatusPlaceholder` function.
  - Rationale: Improves maintainability, reduces code duplication, and makes future UI/UX and accessibility updates easier to apply consistently.
- [x] **Improved accessibility and UX for disabled "Add Comment" button in `public_html/js/ui/community.js`**
  - Added `tabindex="-1"` to prevent keyboard focus on the disabled button.
  - Enhanced `aria-label` to be more descriptive for screen readers.
  - Set `type="button"` for explicit intent.
  - Rationale: Ensures better accessibility for keyboard and screen reader users, and clarifies the button's state and purpose.
- [x] **Added granular debug logs and improved JSDoc comments in `public_html/js/ui/community.js`**
  - Added debug logs for missing DOM elements and when timeouts fire/placeholders are rendered.
  - Updated JSDoc comments for all functions to clarify purpose and parameters.
  - Rationale: Improves traceability for debugging, eases future maintenance, and clarifies code intent for developers.
- [x] **Add Accessible "Add Comment" Form: public_html/js/ui/community.js**
  - **Atomic Change:**  
    Replaced the disabled "Add Comment" button placeholder with a fully functional, accessible comment form. The form includes ARIA labels, focus management, and accessible error messages. Input validation is enforced for required fields and length limits. Submission logic posts to the backend comments API, with robust error handling, persistent error logging, and debug logging for all steps. The UI reflects loading, success, and error states, and the comments list is refreshed on successful submission.
  - **Rationale:**  
    This change delivers a real, accessible comment submission experience, improving usability for all users (including those using assistive technology). It ensures robust error handling, traceability, and a responsive UI, aligning with best practices for accessibility, maintainability, and user experience.
  - **Checklist:**
    - [x] Render accessible "Add Comment" form with ARIA labels and focus management
    - [x] Validate input fields (required, length, accessible error messages)
    - [x] Submit comment to backend API and handle all response states
    - [x] Show loading, success, and error UI states
    - [x] Add debug logging for all steps
    - [x] Log errors persistently for diagnostics
    - [x] Refresh comments list on success
    - [x] Document change and rationale in AUDITFIX.MD
- [x] **Move inline styles from JS-generated markup in `public_html/js/ui/community.js` to CSS classes in `public_html/css/main.css`.**
  - All inline `style="..."` attributes were replaced with semantic CSS classes.
  - New classes were added to `main.css` to preserve the original appearance.
  - JS was updated to use these classes for all dynamic UI elements.
  - Accessibility and ARIA attributes were preserved.
  - *Rationale:* This improves maintainability, enables easier theming, and ensures a clear separation of concerns between structure and presentation.
- [x] **Accessible Popups for Community UI**  
  - Replaced inline error/success messaging in the community add comment form with accessible toasts using the existing `showToast` infrastructure, ensuring ARIA roles, focus management, and keyboard accessibility.
  - Added confirmation modal (using `showConfirmModal`) before comment submission, with full ARIA and keyboard support.
  - All popup invocations now include debug logging for traceability.
  - Rationale: Ensures all user feedback and confirmation dialogs in the community UI are accessible, consistent, and auditable, improving UX for all users and meeting accessibility standards.
- [x] **Atomic Fix: Audit and Correct `/js/modals.js` and `/js/toast.js` References (2025-05-06)**
  - **Atomic Change:**  
    Searched the entire codebase for any imports or script references to `/js/modals.js` and `/js/toast.js` that were missing the `/ui/` segment. No incorrect references were found; all references correctly use `/js/ui/modals.js` and `/js/ui/toast.js`.
  - **Rationale:**  
    Ensures all UI features relying on modals and toasts are properly linked to the correct modular UI scripts. Prevents runtime errors and broken UI functionality due to incorrect script paths, and maintains codebase consistency as the project structure evolves.
  - **Checklist:**
    - [x] Searched for `/js/modals.js` and `/js/toast.js` references missing `/ui/`
    - [x] Confirmed all references use `/js/ui/modals.js` and `/js/ui/toast.js`
    - [x] No changes required; codebase is already correct
    - [x] Documented audit and rationale in AUDITFIX.MD
- [x] **Atomic Fix: Correct all references to `/js/modals.js` and `/js/toast.js` â†’ `/js/ui/modals.js` and `/js/ui/toast.js` in all loader/entrypoint scripts.**
  - **Rationale:** Ensures that all UI features relying on modals and toasts are properly loaded after directory restructuring. Prevents 404 errors and broken UI components.
  - **Result:** Searched all relevant files (`public_html/index.html`, `public_html/js/main.js`, `public_html/js/ui.js`, `public_html/js/ui/eventHandlers.js`, and all loader/entrypoint scripts). All references in the current codebase already use the correct `/js/ui/modals.js` and `/js/ui/toast.js` paths. No changes were required. Legacy code references remain unchanged as they do not affect the current app.
- [x] **Atomic Fix: Audit and Correct `/js/modals.js` and `/js/toast.js` References (2025-05-06)**
  - **Atomic Change:** Searched the entire codebase (including legacy, build scripts, and configuration files) for any dynamic script loading, `import()`, `require()`, or string-based references to `/js/modals.js` and `/js/toast.js`. No incorrect or legacy references were found in any active code; all current references correctly use `/js/ui/modals.js` and `/js/ui/toast.js`.
  - **Rationale:** Ensures all UI features relying on modals and toasts are properly loaded after directory restructuring. Prevents 404 errors and broken UI components. No changes required; codebase is already correct and all features are functional.
  - **Checklist:**
    - [x] Deep search for `/js/modals.js` and `/js/toast.js` (including dynamic, string, and legacy references)
    - [x] Confirmed all active references use `/js/ui/modals.js` and `/js/ui/toast.js`
    - [x] No changes required; codebase is already correct
    - [x] Documented audit and rationale in AUDITFIX.MD
- [x] **Audit: Ensure all dynamic imports, require calls, and script injections for modals and toasts use correct UI paths**
  - Searched all entrypoint and loader scripts (including `public_html/js/main.js`, `public_html/js/ui.js`, `public_html/js/ui/eventHandlers.js`, and all scripts in `public_html/js/`) for any string-based dynamic imports, `import()`, `require()`, or script injection referencing `'js/modals.js'` or `'js/toast.js'` (without `/ui/`).
  - **Result:** No incorrect references found. All code uses correct paths or does not reference these modules incorrectly.
  - **Rationale:** Prevents UI breakage due to missing or misrouted modal and toast modules. Ensures all UI features relying on modals and toasts are correctly restored and loaded.
- [x] **Atomic Fix:** Searched all Playwright and other test/automation scripts for references to `/js/modals.js` and `/js/toast.js`, correcting them to `/js/ui/modals.js` and `/js/ui/toast.js` if found.
  - **Rationale:** Ensures all test scripts reference the correct, current UI module paths, preventing import errors and maintaining consistency after file relocations.
  - **Result:** No references to `/js/modals.js` or `/js/toast.js` were found in any test or automation scripts. No code changes were necessary.
  - **Date:** 2025-05-06
- [x] **Audit: Service Worker & PWA Manifest references to `/js/modals.js` and `/js/toast.js`**
  - **Action:** Searched the entire codebase for any service worker registration (e.g., `serviceWorker.register`) or PWA manifest (e.g., `manifest.json`) that could be requesting `/js/modals.js` or `/js/toast.js`.
  - **Result:** No service worker registrations or PWA manifests referencing these files were found. All references to `modals.js` and `toast.js` are standard ES module imports in UI-related JavaScript files, not in a manifest or service worker context.
  - **Rationale:** Ensures that deprecated or unnecessary service worker/PWA manifest requests for these files do not exist, preventing potential 404s or caching issues. No changes were required.
- [x] **Audit of all JS imports for `modals.js` and `toast.js` path correctness (2025-05-06):**
    - Searched all JS files in `public_html/js/` and subdirectories for import statements referencing `modals.js` or `toast.js` that do not use the `/ui/` path.
    - No incorrect imports were found; all references (if present) use the correct `/js/ui/modals.js` and `/js/ui/toast.js` paths.
    - No code changes were necessary.
    - **Rationale:** Ensures consistent and correct module resolution, prevents runtime errors due to incorrect import paths, and maintains codebase integrity.